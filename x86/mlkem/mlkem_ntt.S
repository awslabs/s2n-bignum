// Copyright (c) 2024 The mlkem-native project authors
// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
// SPDX-License-Identifier: Apache-2.0 OR ISC OR MIT

// ----------------------------------------------------------------------------
// Forward number-theoretic transform from ML-KEM
// Input a[256], qdata[624] (all signed 16-bit words); output a[256] (signed 16-bit words).
//
// The transform is in-place with input and output a[256], with the output
// in bitreversed order. The second parameter is expected to point to a
// table of constants whose definitions can be found in the mlkem-native
// repo or our "tests/test.c".
//
// extern void mlkem_ntt_x86(int16_t a[static 256], const int16_t qdata[static 624]);
//
// Standard x86-64 ABI: RDI = a, RSI = qdata
// Microsoft x64 ABI:   RCX = a, RDX = qdata
// ----------------------------------------------------------------------------
#include "_internal_s2n_bignum_x86.h"

.intel_syntax noprefix
        S2N_BN_SYM_VISIBILITY_DIRECTIVE(mlkem_ntt_x86)
        S2N_BN_FUNCTION_TYPE_DIRECTIVE(mlkem_ntt_x86)
        S2N_BN_SYM_PRIVACY_DIRECTIVE(mlkem_ntt_x86)
        .text
        .balign 4

S2N_BN_SYMBOL(mlkem_ntt_x86):
        CFI_START
        _CET_ENDBR

#if WINDOWS_ABI
        CFI_DEC_RSP(176)
        CFI_STACKSAVEU(xmm6,0)
        CFI_STACKSAVEU(xmm7,16)
        CFI_STACKSAVEU(xmm8,32)
        CFI_STACKSAVEU(xmm9,48)
        CFI_STACKSAVEU(xmm10,64)
        CFI_STACKSAVEU(xmm11,80)
        CFI_STACKSAVEU(xmm12,96)
        CFI_STACKSAVEU(xmm13,112)
        CFI_STACKSAVEU(xmm14,128)
        CFI_STACKSAVEU(xmm15,144)
        CFI_STACKSAVE(rdi,160)
        CFI_STACKSAVE(rsi,168)
        mov rdi, rcx
        mov rsi, rdx
#endif

 mov eax,0xd010d01
 vmovd xmm0,eax
 vpbroadcastd ymm0,xmm0
 vpbroadcastq ymm15,[64+rsi]
 vmovdqa ymm8,[256+rdi]
 vmovdqa ymm9,[288+rdi]
 vmovdqa ymm10,[320+rdi]
 vmovdqa ymm11,[352+rdi]
 vpbroadcastq ymm2,[72+rsi]
 vpmullw ymm12,ymm8,ymm15
 vpmullw ymm13,ymm9,ymm15
 vpmullw ymm14,ymm10,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm8,ymm8,ymm2
 vpmulhw ymm9,ymm9,ymm2
 vpmulhw ymm10,ymm10,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vmovdqa ymm4,[rdi]
 vmovdqa ymm5,[32+rdi]
 vmovdqa ymm6,[64+rdi]
 vmovdqa ymm7,[96+rdi]
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm3,ymm4,ymm8
 vpsubw ymm8,ymm4,ymm8
 vpaddw ymm4,ymm5,ymm9
 vpsubw ymm9,ymm5,ymm9
 vpaddw ymm5,ymm6,ymm10
 vpsubw ymm10,ymm6,ymm10
 vpaddw ymm6,ymm7,ymm11
 vpsubw ymm11,ymm7,ymm11
 vpsubw ymm3,ymm3,ymm12
 vpaddw ymm8,ymm8,ymm12
 vpsubw ymm4,ymm4,ymm13
 vpaddw ymm9,ymm9,ymm13
 vpsubw ymm5,ymm5,ymm14
 vpaddw ymm10,ymm10,ymm14
 vpsubw ymm6,ymm6,ymm15
 vpaddw ymm11,ymm11,ymm15
 vmovdqa [rdi],ymm3
 vmovdqa [32+rdi],ymm4
 vmovdqa [64+rdi],ymm5
 vmovdqa [96+rdi],ymm6
 vmovdqa [256+rdi],ymm8
 vmovdqa [288+rdi],ymm9
 vmovdqa [320+rdi],ymm10
 vmovdqa [352+rdi],ymm11
 vpbroadcastq ymm15,[64+rsi]
 vmovdqa ymm8,[384+rdi]
 vmovdqa ymm9,[416+rdi]
 vmovdqa ymm10,[448+rdi]
 vmovdqa ymm11,[480+rdi]
 vpbroadcastq ymm2,[72+rsi]
 vpmullw ymm12,ymm8,ymm15
 vpmullw ymm13,ymm9,ymm15
 vpmullw ymm14,ymm10,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm8,ymm8,ymm2
 vpmulhw ymm9,ymm9,ymm2
 vpmulhw ymm10,ymm10,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vmovdqa ymm4,[128+rdi]
 vmovdqa ymm5,[160+rdi]
 vmovdqa ymm6,[192+rdi]
 vmovdqa ymm7,[224+rdi]
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm3,ymm4,ymm8
 vpsubw ymm8,ymm4,ymm8
 vpaddw ymm4,ymm5,ymm9
 vpsubw ymm9,ymm5,ymm9
 vpaddw ymm5,ymm6,ymm10
 vpsubw ymm10,ymm6,ymm10
 vpaddw ymm6,ymm7,ymm11
 vpsubw ymm11,ymm7,ymm11
 vpsubw ymm3,ymm3,ymm12
 vpaddw ymm8,ymm8,ymm12
 vpsubw ymm4,ymm4,ymm13
 vpaddw ymm9,ymm9,ymm13
 vpsubw ymm5,ymm5,ymm14
 vpaddw ymm10,ymm10,ymm14
 vpsubw ymm6,ymm6,ymm15
 vpaddw ymm11,ymm11,ymm15
 vmovdqa [128+rdi],ymm3
 vmovdqa [160+rdi],ymm4
 vmovdqa [192+rdi],ymm5
 vmovdqa [224+rdi],ymm6
 vmovdqa [384+rdi],ymm8
 vmovdqa [416+rdi],ymm9
 vmovdqa [448+rdi],ymm10
 vmovdqa [480+rdi],ymm11
 vmovdqa ymm15,[96+rsi]
 vmovdqa ymm8,[128+rdi]
 vmovdqa ymm9,[160+rdi]
 vmovdqa ymm10,[192+rdi]
 vmovdqa ymm11,[224+rdi]
 vmovdqa ymm2,[128+rsi]
 vpmullw ymm12,ymm8,ymm15
 vpmullw ymm13,ymm9,ymm15
 vpmullw ymm14,ymm10,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm8,ymm8,ymm2
 vpmulhw ymm9,ymm9,ymm2
 vpmulhw ymm10,ymm10,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vmovdqa ymm4,[rdi]
 vmovdqa ymm5,[32+rdi]
 vmovdqa ymm6,[64+rdi]
 vmovdqa ymm7,[96+rdi]
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm3,ymm4,ymm8
 vpsubw ymm8,ymm4,ymm8
 vpaddw ymm4,ymm5,ymm9
 vpsubw ymm9,ymm5,ymm9
 vpaddw ymm5,ymm6,ymm10
 vpsubw ymm10,ymm6,ymm10
 vpaddw ymm6,ymm7,ymm11
 vpsubw ymm11,ymm7,ymm11
 vpsubw ymm3,ymm3,ymm12
 vpaddw ymm8,ymm8,ymm12
 vpsubw ymm4,ymm4,ymm13
 vpaddw ymm9,ymm9,ymm13
 vpsubw ymm5,ymm5,ymm14
 vpaddw ymm10,ymm10,ymm14
 vpsubw ymm6,ymm6,ymm15
 vpaddw ymm11,ymm11,ymm15
 vperm2i128 ymm7,ymm5,ymm10,0x20
 vperm2i128 ymm10,ymm5,ymm10,0x31
 vperm2i128 ymm5,ymm6,ymm11,0x20
 vperm2i128 ymm11,ymm6,ymm11,0x31
 vmovdqa ymm15,[160+rsi]
 vmovdqa ymm2,[192+rsi]
 vpmullw ymm12,ymm7,ymm15
 vpmullw ymm13,ymm10,ymm15
 vpmullw ymm14,ymm5,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm7,ymm7,ymm2
 vpmulhw ymm10,ymm10,ymm2
 vpmulhw ymm5,ymm5,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vperm2i128 ymm6,ymm3,ymm8,0x20
 vperm2i128 ymm8,ymm3,ymm8,0x31
 vperm2i128 ymm3,ymm4,ymm9,0x20
 vperm2i128 ymm9,ymm4,ymm9,0x31
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm4,ymm6,ymm7
 vpsubw ymm7,ymm6,ymm7
 vpaddw ymm6,ymm8,ymm10
 vpsubw ymm10,ymm8,ymm10
 vpaddw ymm8,ymm3,ymm5
 vpsubw ymm5,ymm3,ymm5
 vpaddw ymm3,ymm9,ymm11
 vpsubw ymm11,ymm9,ymm11
 vpsubw ymm4,ymm4,ymm12
 vpaddw ymm7,ymm7,ymm12
 vpsubw ymm6,ymm6,ymm13
 vpaddw ymm10,ymm10,ymm13
 vpsubw ymm8,ymm8,ymm14
 vpaddw ymm5,ymm5,ymm14
 vpsubw ymm3,ymm3,ymm15
 vpaddw ymm11,ymm11,ymm15
 vpunpcklqdq ymm9,ymm8,ymm5
 vpunpckhqdq ymm5,ymm8,ymm5
 vpunpcklqdq ymm8,ymm3,ymm11
 vpunpckhqdq ymm11,ymm3,ymm11
 vmovdqa ymm15,[224+rsi]
 vmovdqa ymm2,[256+rsi]
 vpmullw ymm12,ymm9,ymm15
 vpmullw ymm13,ymm5,ymm15
 vpmullw ymm14,ymm8,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm9,ymm9,ymm2
 vpmulhw ymm5,ymm5,ymm2
 vpmulhw ymm8,ymm8,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vpunpcklqdq ymm3,ymm4,ymm7
 vpunpckhqdq ymm7,ymm4,ymm7
 vpunpcklqdq ymm4,ymm6,ymm10
 vpunpckhqdq ymm10,ymm6,ymm10
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm6,ymm3,ymm9
 vpsubw ymm9,ymm3,ymm9
 vpaddw ymm3,ymm7,ymm5
 vpsubw ymm5,ymm7,ymm5
 vpaddw ymm7,ymm4,ymm8
 vpsubw ymm8,ymm4,ymm8
 vpaddw ymm4,ymm10,ymm11
 vpsubw ymm11,ymm10,ymm11
 vpsubw ymm6,ymm6,ymm12
 vpaddw ymm9,ymm9,ymm12
 vpsubw ymm3,ymm3,ymm13
 vpaddw ymm5,ymm5,ymm13
 vpsubw ymm7,ymm7,ymm14
 vpaddw ymm8,ymm8,ymm14
 vpsubw ymm4,ymm4,ymm15
 vpaddw ymm11,ymm11,ymm15
 vmovsldup ymm10,ymm8
 vpblendd ymm10,ymm7,ymm10,0xaa
 vpsrlq ymm7,ymm7,0x20
 vpblendd ymm8,ymm7,ymm8,0xaa
 vmovsldup ymm7,ymm11
 vpblendd ymm7,ymm4,ymm7,0xaa
 vpsrlq ymm4,ymm4,0x20
 vpblendd ymm11,ymm4,ymm11,0xaa
 vmovdqa ymm15,[288+rsi]
 vmovdqa ymm2,[320+rsi]
 vpmullw ymm12,ymm10,ymm15
 vpmullw ymm13,ymm8,ymm15
 vpmullw ymm14,ymm7,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm10,ymm10,ymm2
 vpmulhw ymm8,ymm8,ymm2
 vpmulhw ymm7,ymm7,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vmovsldup ymm4,ymm9
 vpblendd ymm4,ymm6,ymm4,0xaa
 vpsrlq ymm6,ymm6,0x20
 vpblendd ymm9,ymm6,ymm9,0xaa
 vmovsldup ymm6,ymm5
 vpblendd ymm6,ymm3,ymm6,0xaa
 vpsrlq ymm3,ymm3,0x20
 vpblendd ymm5,ymm3,ymm5,0xaa
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm3,ymm4,ymm10
 vpsubw ymm10,ymm4,ymm10
 vpaddw ymm4,ymm9,ymm8
 vpsubw ymm8,ymm9,ymm8
 vpaddw ymm9,ymm6,ymm7
 vpsubw ymm7,ymm6,ymm7
 vpaddw ymm6,ymm5,ymm11
 vpsubw ymm11,ymm5,ymm11
 vpsubw ymm3,ymm3,ymm12
 vpaddw ymm10,ymm10,ymm12
 vpsubw ymm4,ymm4,ymm13
 vpaddw ymm8,ymm8,ymm13
 vpsubw ymm9,ymm9,ymm14
 vpaddw ymm7,ymm7,ymm14
 vpsubw ymm6,ymm6,ymm15
 vpaddw ymm11,ymm11,ymm15
 vpslld ymm5,ymm7,0x10
 vpblendw ymm5,ymm9,ymm5,0xaa
 vpsrld ymm9,ymm9,0x10
 vpblendw ymm7,ymm9,ymm7,0xaa
 vpslld ymm9,ymm11,0x10
 vpblendw ymm9,ymm6,ymm9,0xaa
 vpsrld ymm6,ymm6,0x10
 vpblendw ymm11,ymm6,ymm11,0xaa
 vmovdqa ymm15,[352+rsi]
 vmovdqa ymm2,[384+rsi]
 vpmullw ymm12,ymm5,ymm15
 vpmullw ymm13,ymm7,ymm15
 vpmullw ymm14,ymm9,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm5,ymm5,ymm2
 vpmulhw ymm7,ymm7,ymm2
 vpmulhw ymm9,ymm9,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vpslld ymm6,ymm10,0x10
 vpblendw ymm6,ymm3,ymm6,0xaa
 vpsrld ymm3,ymm3,0x10
 vpblendw ymm10,ymm3,ymm10,0xaa
 vpslld ymm3,ymm8,0x10
 vpblendw ymm3,ymm4,ymm3,0xaa
 vpsrld ymm4,ymm4,0x10
 vpblendw ymm8,ymm4,ymm8,0xaa
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm4,ymm6,ymm5
 vpsubw ymm5,ymm6,ymm5
 vpaddw ymm6,ymm10,ymm7
 vpsubw ymm7,ymm10,ymm7
 vpaddw ymm10,ymm3,ymm9
 vpsubw ymm9,ymm3,ymm9
 vpaddw ymm3,ymm8,ymm11
 vpsubw ymm11,ymm8,ymm11
 vpsubw ymm4,ymm4,ymm12
 vpaddw ymm5,ymm5,ymm12
 vpsubw ymm6,ymm6,ymm13
 vpaddw ymm7,ymm7,ymm13
 vpsubw ymm10,ymm10,ymm14
 vpaddw ymm9,ymm9,ymm14
 vpsubw ymm3,ymm3,ymm15
 vpaddw ymm11,ymm11,ymm15
 vmovdqa ymm14,[416+rsi]
 vmovdqa ymm15,[480+rsi]
 vmovdqa ymm8,[448+rsi]
 vmovdqa ymm2,[512+rsi]
 vpmullw ymm12,ymm10,ymm14
 vpmullw ymm13,ymm3,ymm14
 vpmullw ymm14,ymm9,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm10,ymm10,ymm8
 vpmulhw ymm3,ymm3,ymm8
 vpmulhw ymm9,ymm9,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm8,ymm4,ymm10
 vpsubw ymm10,ymm4,ymm10
 vpaddw ymm4,ymm6,ymm3
 vpsubw ymm3,ymm6,ymm3
 vpaddw ymm6,ymm5,ymm9
 vpsubw ymm9,ymm5,ymm9
 vpaddw ymm5,ymm7,ymm11
 vpsubw ymm11,ymm7,ymm11
 vpsubw ymm8,ymm8,ymm12
 vpaddw ymm10,ymm10,ymm12
 vpsubw ymm4,ymm4,ymm13
 vpaddw ymm3,ymm3,ymm13
 vpsubw ymm6,ymm6,ymm14
 vpaddw ymm9,ymm9,ymm14
 vpsubw ymm5,ymm5,ymm15
 vpaddw ymm11,ymm11,ymm15
 vmovdqa [rdi],ymm8
 vmovdqa [32+rdi],ymm4
 vmovdqa [64+rdi],ymm10
 vmovdqa [96+rdi],ymm3
 vmovdqa [128+rdi],ymm6
 vmovdqa [160+rdi],ymm5
 vmovdqa [192+rdi],ymm9
 vmovdqa [224+rdi],ymm11
 vmovdqa ymm15,[544+rsi]
 vmovdqa ymm8,[384+rdi]
 vmovdqa ymm9,[416+rdi]
 vmovdqa ymm10,[448+rdi]
 vmovdqa ymm11,[480+rdi]
 vmovdqa ymm2,[576+rsi]
 vpmullw ymm12,ymm8,ymm15
 vpmullw ymm13,ymm9,ymm15
 vpmullw ymm14,ymm10,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm8,ymm8,ymm2
 vpmulhw ymm9,ymm9,ymm2
 vpmulhw ymm10,ymm10,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vmovdqa ymm4,[256+rdi]
 vmovdqa ymm5,[288+rdi]
 vmovdqa ymm6,[320+rdi]
 vmovdqa ymm7,[352+rdi]
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm3,ymm4,ymm8
 vpsubw ymm8,ymm4,ymm8
 vpaddw ymm4,ymm5,ymm9
 vpsubw ymm9,ymm5,ymm9
 vpaddw ymm5,ymm6,ymm10
 vpsubw ymm10,ymm6,ymm10
 vpaddw ymm6,ymm7,ymm11
 vpsubw ymm11,ymm7,ymm11
 vpsubw ymm3,ymm3,ymm12
 vpaddw ymm8,ymm8,ymm12
 vpsubw ymm4,ymm4,ymm13
 vpaddw ymm9,ymm9,ymm13
 vpsubw ymm5,ymm5,ymm14
 vpaddw ymm10,ymm10,ymm14
 vpsubw ymm6,ymm6,ymm15
 vpaddw ymm11,ymm11,ymm15
 vperm2i128 ymm7,ymm5,ymm10,0x20
 vperm2i128 ymm10,ymm5,ymm10,0x31
 vperm2i128 ymm5,ymm6,ymm11,0x20
 vperm2i128 ymm11,ymm6,ymm11,0x31
 vmovdqa ymm15,[608+rsi]
 vmovdqa ymm2,[640+rsi]
 vpmullw ymm12,ymm7,ymm15
 vpmullw ymm13,ymm10,ymm15
 vpmullw ymm14,ymm5,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm7,ymm7,ymm2
 vpmulhw ymm10,ymm10,ymm2
 vpmulhw ymm5,ymm5,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vperm2i128 ymm6,ymm3,ymm8,0x20
 vperm2i128 ymm8,ymm3,ymm8,0x31
 vperm2i128 ymm3,ymm4,ymm9,0x20
 vperm2i128 ymm9,ymm4,ymm9,0x31
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm4,ymm6,ymm7
 vpsubw ymm7,ymm6,ymm7
 vpaddw ymm6,ymm8,ymm10
 vpsubw ymm10,ymm8,ymm10
 vpaddw ymm8,ymm3,ymm5
 vpsubw ymm5,ymm3,ymm5
 vpaddw ymm3,ymm9,ymm11
 vpsubw ymm11,ymm9,ymm11
 vpsubw ymm4,ymm4,ymm12
 vpaddw ymm7,ymm7,ymm12
 vpsubw ymm6,ymm6,ymm13
 vpaddw ymm10,ymm10,ymm13
 vpsubw ymm8,ymm8,ymm14
 vpaddw ymm5,ymm5,ymm14
 vpsubw ymm3,ymm3,ymm15
 vpaddw ymm11,ymm11,ymm15
 vpunpcklqdq ymm9,ymm8,ymm5
 vpunpckhqdq ymm5,ymm8,ymm5
 vpunpcklqdq ymm8,ymm3,ymm11
 vpunpckhqdq ymm11,ymm3,ymm11
 vmovdqa ymm15,[672+rsi]
 vmovdqa ymm2,[704+rsi]
 vpmullw ymm12,ymm9,ymm15
 vpmullw ymm13,ymm5,ymm15
 vpmullw ymm14,ymm8,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm9,ymm9,ymm2
 vpmulhw ymm5,ymm5,ymm2
 vpmulhw ymm8,ymm8,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vpunpcklqdq ymm3,ymm4,ymm7
 vpunpckhqdq ymm7,ymm4,ymm7
 vpunpcklqdq ymm4,ymm6,ymm10
 vpunpckhqdq ymm10,ymm6,ymm10
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm6,ymm3,ymm9
 vpsubw ymm9,ymm3,ymm9
 vpaddw ymm3,ymm7,ymm5
 vpsubw ymm5,ymm7,ymm5
 vpaddw ymm7,ymm4,ymm8
 vpsubw ymm8,ymm4,ymm8
 vpaddw ymm4,ymm10,ymm11
 vpsubw ymm11,ymm10,ymm11
 vpsubw ymm6,ymm6,ymm12
 vpaddw ymm9,ymm9,ymm12
 vpsubw ymm3,ymm3,ymm13
 vpaddw ymm5,ymm5,ymm13
 vpsubw ymm7,ymm7,ymm14
 vpaddw ymm8,ymm8,ymm14
 vpsubw ymm4,ymm4,ymm15
 vpaddw ymm11,ymm11,ymm15
 vmovsldup ymm10,ymm8
 vpblendd ymm10,ymm7,ymm10,0xaa
 vpsrlq ymm7,ymm7,0x20
 vpblendd ymm8,ymm7,ymm8,0xaa
 vmovsldup ymm7,ymm11
 vpblendd ymm7,ymm4,ymm7,0xaa
 vpsrlq ymm4,ymm4,0x20
 vpblendd ymm11,ymm4,ymm11,0xaa
 vmovdqa ymm15,[736+rsi]
 vmovdqa ymm2,[768+rsi]
 vpmullw ymm12,ymm10,ymm15
 vpmullw ymm13,ymm8,ymm15
 vpmullw ymm14,ymm7,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm10,ymm10,ymm2
 vpmulhw ymm8,ymm8,ymm2
 vpmulhw ymm7,ymm7,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vmovsldup ymm4,ymm9
 vpblendd ymm4,ymm6,ymm4,0xaa
 vpsrlq ymm6,ymm6,0x20
 vpblendd ymm9,ymm6,ymm9,0xaa
 vmovsldup ymm6,ymm5
 vpblendd ymm6,ymm3,ymm6,0xaa
 vpsrlq ymm3,ymm3,0x20
 vpblendd ymm5,ymm3,ymm5,0xaa
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm3,ymm4,ymm10
 vpsubw ymm10,ymm4,ymm10
 vpaddw ymm4,ymm9,ymm8
 vpsubw ymm8,ymm9,ymm8
 vpaddw ymm9,ymm6,ymm7
 vpsubw ymm7,ymm6,ymm7
 vpaddw ymm6,ymm5,ymm11
 vpsubw ymm11,ymm5,ymm11
 vpsubw ymm3,ymm3,ymm12
 vpaddw ymm10,ymm10,ymm12
 vpsubw ymm4,ymm4,ymm13
 vpaddw ymm8,ymm8,ymm13
 vpsubw ymm9,ymm9,ymm14
 vpaddw ymm7,ymm7,ymm14
 vpsubw ymm6,ymm6,ymm15
 vpaddw ymm11,ymm11,ymm15
 vpslld ymm5,ymm7,0x10
 vpblendw ymm5,ymm9,ymm5,0xaa
 vpsrld ymm9,ymm9,0x10
 vpblendw ymm7,ymm9,ymm7,0xaa
 vpslld ymm9,ymm11,0x10
 vpblendw ymm9,ymm6,ymm9,0xaa
 vpsrld ymm6,ymm6,0x10
 vpblendw ymm11,ymm6,ymm11,0xaa
 vmovdqa ymm15,[800+rsi]
 vmovdqa ymm2,[832+rsi]
 vpmullw ymm12,ymm5,ymm15
 vpmullw ymm13,ymm7,ymm15
 vpmullw ymm14,ymm9,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm5,ymm5,ymm2
 vpmulhw ymm7,ymm7,ymm2
 vpmulhw ymm9,ymm9,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vpslld ymm6,ymm10,0x10
 vpblendw ymm6,ymm3,ymm6,0xaa
 vpsrld ymm3,ymm3,0x10
 vpblendw ymm10,ymm3,ymm10,0xaa
 vpslld ymm3,ymm8,0x10
 vpblendw ymm3,ymm4,ymm3,0xaa
 vpsrld ymm4,ymm4,0x10
 vpblendw ymm8,ymm4,ymm8,0xaa
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm4,ymm6,ymm5
 vpsubw ymm5,ymm6,ymm5
 vpaddw ymm6,ymm10,ymm7
 vpsubw ymm7,ymm10,ymm7
 vpaddw ymm10,ymm3,ymm9
 vpsubw ymm9,ymm3,ymm9
 vpaddw ymm3,ymm8,ymm11
 vpsubw ymm11,ymm8,ymm11
 vpsubw ymm4,ymm4,ymm12
 vpaddw ymm5,ymm5,ymm12
 vpsubw ymm6,ymm6,ymm13
 vpaddw ymm7,ymm7,ymm13
 vpsubw ymm10,ymm10,ymm14
 vpaddw ymm9,ymm9,ymm14
 vpsubw ymm3,ymm3,ymm15
 vpaddw ymm11,ymm11,ymm15
 vmovdqa ymm14,[864+rsi]
 vmovdqa ymm15,[928+rsi]
 vmovdqa ymm8,[896+rsi]
 vmovdqa ymm2,[960+rsi]
 vpmullw ymm12,ymm10,ymm14
 vpmullw ymm13,ymm3,ymm14
 vpmullw ymm14,ymm9,ymm15
 vpmullw ymm15,ymm11,ymm15
 vpmulhw ymm10,ymm10,ymm8
 vpmulhw ymm3,ymm3,ymm8
 vpmulhw ymm9,ymm9,ymm2
 vpmulhw ymm11,ymm11,ymm2
 vpmulhw ymm12,ymm12,ymm0
 vpmulhw ymm13,ymm13,ymm0
 vpmulhw ymm14,ymm14,ymm0
 vpmulhw ymm15,ymm15,ymm0
 vpaddw ymm8,ymm4,ymm10
 vpsubw ymm10,ymm4,ymm10
 vpaddw ymm4,ymm6,ymm3
 vpsubw ymm3,ymm6,ymm3
 vpaddw ymm6,ymm5,ymm9
 vpsubw ymm9,ymm5,ymm9
 vpaddw ymm5,ymm7,ymm11
 vpsubw ymm11,ymm7,ymm11
 vpsubw ymm8,ymm8,ymm12
 vpaddw ymm10,ymm10,ymm12
 vpsubw ymm4,ymm4,ymm13
 vpaddw ymm3,ymm3,ymm13
 vpsubw ymm6,ymm6,ymm14
 vpaddw ymm9,ymm9,ymm14
 vpsubw ymm5,ymm5,ymm15
 vpaddw ymm11,ymm11,ymm15
 vmovdqa [256+rdi],ymm8
 vmovdqa [288+rdi],ymm4
 vmovdqa [320+rdi],ymm10
 vmovdqa [352+rdi],ymm3
 vmovdqa [384+rdi],ymm6
 vmovdqa [416+rdi],ymm5
 vmovdqa [448+rdi],ymm9
 vmovdqa [480+rdi],ymm11

#if WINDOWS_ABI
        CFI_STACKLOADU(xmm6,0)
        CFI_STACKLOADU(xmm7,16)
        CFI_STACKLOADU(xmm8,32)
        CFI_STACKLOADU(xmm9,48)
        CFI_STACKLOADU(xmm10,64)
        CFI_STACKLOADU(xmm11,80)
        CFI_STACKLOADU(xmm12,96)
        CFI_STACKLOADU(xmm13,112)
        CFI_STACKLOADU(xmm14,128)
        CFI_STACKLOADU(xmm15,144)
        CFI_STACKLOAD(rdi,160)
        CFI_STACKLOAD(rsi,168)
        CFI_INC_RSP(176)
#endif
        CFI_RET

S2N_BN_SIZE_DIRECTIVE(mlkem_ntt_x86)

#if defined(__linux__) && defined(__ELF__)
.section .note.GNU-stack,"",%progbits
#endif
